//*******************************************************
//CONTROL IC:SSD1306
//Model style:128*64
//1/64 duty    Vop:14.0V  VDD:3.3V  1/11bias
//FINISH DATA:
//SERIEA:6800/8080/SPI
//*******************************************************

#include <stdio.h>                  
#include <reg51.h>
#include <ctype.h>
#include <intrins.h>
#include <string.h>
#define Uchar unsigned char
#define Uint  unsigned int
#define TransPort P1
#define nop() _nop_()
#define MHz 12                      //晶振频率

//*******************************************************
//函数名称：无
//功能：定义接口
//参数：无
//*******************************************************
sbit CS=P3^4;
sbit RST=P3^3;
sbit E=P3^0;
sbit R_W=P3^1;
sbit A0=P3^2;
sbit SCLK=P1^0;
sbit SDA=P1^1;
sbit KEY=P2^0;
sbit UP=P2^1;
sbit DOWN=P2^2;

//*******************************************************
//函数名称：无
//功能：时序选择全局变量定义
//参数：无
//*******************************************************
unsigned char SPI=0;
unsigned char P6800=1;
unsigned char P8080=2;
unsigned char TIME=1;    //时序的选折

//*******************************************************
//函数名称：无
//功能：数据和函数声明
//参数：无
//*******************************************************
unsigned char code pic[];
void Delay_1ms(unsigned char delay); // 基准为1ms的延时函数,最大255ms
void WaitKey();
void Write_Command(Uchar Command);
void Write_Command_SPI(Uchar Command);
void Write_Command_P6800(Uchar Command);
void Write_Command_P8080(Uchar Command);
void Write_Data(Uchar Data);
void Write_Data_SPI(Uchar Data);
void Write_Data_P6800(Uchar Data);
void Write_Data_P8080(Uchar Data);
void Init_Lcd(void);
void Display(Uchar Data1,Uchar Data2);
void Display1(Uchar Data1,Uchar Data2);
void DisplayPicture(Uchar *PIC);
void Delay(Uint t);

//*******************************************************
//函数名称：main
//功能：主函数
//参数：无
//*******************************************************
void main( )
  {
   Init_Lcd();
   while(1)
   {

    Write_Command(0x81);//set contrast control
	Write_Command(0x00);
    Display(0xFF,0xFF);            
    Delay(50);
    //WaitKey();

    Write_Command(0x81);//set contrast control
	Write_Command(0x88);
    Display(0xFF,0xFF);            
    Delay(50);
    //WaitKey();
    
    //Display(0x00,0x00);    
    //Delay(50);   
    
    Display1(0x33,0xCC);    
    Delay(50);    

    Display(0xAA,0xAA);  
    Delay(50); 
        
    Display(0xFF,0x00);
    Delay(50);    

    Display(0x55,0xAA);
    Delay(50); 
     
    DisplayPicture(pic);
    Delay(50);  
    //WaitKey();
    

   }
  }

//*******************************************************
//函数名称：Init_LCD
//功能：设置LCD所用芯片中各寄存器的值
//参数：无
//*******************************************************
void Init_Lcd(void)
{   
    
	RST=1;
	Delay_1ms(100);
	RST=0;
	Delay_1ms(100);
	RST=1;
	Delay_1ms(100);

	Write_Command(0xAE);//set display display ON/OFF,AFH/AEH
	
	Write_Command(0x40);//set display start line:COM0	

	Write_Command(0x81);//set contrast control
	Write_Command(0x88);	

	Write_Command(0x20);//set memory addressing mode
	Write_Command(0x02);//page addressing mode		

	Write_Command(0xA0);//set segment re-map

	Write_Command(0xA4);//entire display on: A4H:OFF/A5H:ON

	Write_Command(0xA6);//set normal/inverse display: A6H:normal/A7H:inverse

	Write_Command(0xA8);//set multiplex ratio
	Write_Command(0x3F);//1/64duty

	Write_Command(0xC0);//set com output scan direction

	Write_Command(0xD3);//set display  offset
	Write_Command(0x00);//

	Write_Command(0xD5);//set display  clock divide ratio/oscillator frequency
	Write_Command(0x80);//105Hz

    Write_Command(0xD9);//set pre-charge period
	Write_Command(0xF1);//

	Write_Command(0xDA);//set com pins hardware configuration
	Write_Command(0x12);//

    Write_Command(0xDB);//set vcomh deselect level
	Write_Command(0x30);//0.83*VCC
		
	Write_Command(0x8D);//charge pump setting
	Write_Command(0x14);//enable charge pump,VCC=7.5V

	Write_Command(0xAF);//set display display ON/OFF,AEH/AFH
      
}


//*******************************************************
//函数名称：Delay_1ms
//功能：延时函数,基准值为1ms,最大255毫秒 
//参数：delay
//*******************************************************
void Delay_1ms(unsigned char delay)
{ 
  unsigned char i,j,tmp;
  tmp = (char)((100*MHz)/12+23);  //根据晶振频率计算内层循环初值,调整23可以对延时时间进行微调
  for(i=0;i<delay;i++)
   {
    for(j=0;j<tmp;j++);
   }
}

//*******************************************************
//函数名称：Delay
//功能：延时函数
//参数：t
//*******************************************************
void Delay(Uint t)
{
  unsigned char i;
  unsigned int j;
  for(i=0;i<=t;i++)
  for(j=0;j<2000;j++);
}

//*******************************************************
//函数名称：WaitKey
//功能：显示画面暂停，只有当KEY=0时才跳转
//参数：无
//*******************************************************
void WaitKey()
 {
  //return;
  while(KEY)
  {
   ;
  }
 }

//*******************************************************
//函数名称：Write_Command
//功能：写指令，通过此函数可选折各种时序
//参数：Command
//*******************************************************
void Write_Command(Uchar Command)
{ 
   switch(TIME)
     {
       case 0:	
         Write_Command_SPI(Command);
       break;
       case 1:	
         Write_Command_P6800(Command);
       break;
       case 2:	
         Write_Command_P8080(Command);
       break;
     }
}

//*******************************************************
//函数名称：Write_Command_SPI
//功能：串口写指令
//参数：Command
//*******************************************************
void Write_Command_SPI(Uchar Command)
{
    int i;
	CS=0;
    A0=0;
    for(i=0;i<8;i++)
     {
      SCLK=0;
      if((Command&0x80)==0)
        SDA=0;
      else
        SDA=1;
      SCLK=1;
      Command=Command<<1;
     }
 }

//*******************************************************
//函数名称：Write_Command_P6800
//功能：并口6800时序写数据
//参数：Command
//*******************************************************
void Write_Command_P6800(Uchar Command)
{
	CS=0;
	A0=0;
	R_W=0;
    TransPort=Command;
    nop();
	E=1;
    nop();
	E=0;  
	CS=1;   
 }

//*******************************************************
//函数名称：Write_Command_P8080
//功能：并口8080时序写数据
//参数：Command
//*******************************************************
void Write_Command_P8080(Uchar Command)
{   
    
    CS=0; 	
	A0=0;
	E=1;
	R_W=0;
	TransPort=Command;		
	//_nop_();
	//_nop_();
	R_W=1;
	//CS=0;
	
}

//*******************************************************
//函数名称：Write_Data
//功能：写数据，通过此函数可选折各种时序
//参数：Data
//*******************************************************
void Write_Data(Uchar Data)
{ 
   switch(TIME)
     {
       case 0:	
         Write_Data_SPI(Data);
       break;
       case 1:	
         Write_Data_P6800(Data);
       break;
       case 2:	
         Write_Data_P8080(Data);
       break;
     }
}

//*******************************************************
//函数名称：Write_Data_SPI
//功能：串口写数据
//参数：Data
//*******************************************************
void Write_Data_SPI(Uchar Data)
{
 	int i;
    CS=0;
    A0=1;
    for(i=0;i<8;i++)
     {
      SCLK=0;
      if((Data&0x80)==0)
        SDA=0;
      else
        SDA=1;
      SCLK=1;
      Data=Data<<1;
     }
}

//*******************************************************
//函数名称：Write_Data_P6800
//功能：并口6800写数据
//参数：Data
//*******************************************************
void Write_Data_P6800(Uchar Data)
{
 	CS=0;
	A0=1;
	R_W=0;
	TransPort=Data;
    nop();
	E=1;
    nop();
	E=0;  
	CS=1;   
}

//*******************************************************
//函数名称：Write_Data_P8080
//功能：并口8080写数据
//参数：Data
//*******************************************************
void Write_Data_P8080(Uchar Data)
{   
    CS=0; 	
	A0=1;
	E=1;	
	R_W=0;
	TransPort=Data;	
  	//_nop_();
  	//_nop_();
  	R_W=1;
  	//CS=0;

}
 
//*******************************************************
//函数名称：Display
//功能：显示图案
//参数：Data1,Data2
//*******************************************************
void Display(Uchar Data1,Uchar Data2)
{
	int i,j;     
    for(i=0;i<8;i++)
	 {	
	  Write_Command(0xB0+i);//set pageaddress start adress
	  Write_Command(0x00);  //set lower column start address
	  Write_Command(0x10);  //set higher column start address	  
	  for(j=0;j<64;j++)
	    { 	      
	      Write_Data(Data1);
	      Write_Data(Data2);
	    }	  
     }
     
    
}

//*******************************************************
//函数名称：Display1
//功能：显示图案
//参数：Data1,Data2
//*******************************************************
void Display1(Uchar Data1,Uchar Data2)
{
	int i,j;     
    for(i=0;i<8;i++)
	 {	
	  Write_Command(0xB0+i);//set pageaddress start adress
	  Write_Command(0x00);  //set lower column start address
	  Write_Command(0x10);  //set higher column start address	  
	  for(j=0;j<64;j++)
	    { 	      
	      Write_Data(Data1);
	      Write_Data(Data1);
	      Write_Data(Data2);
	      Write_Data(Data2);
	    }	  
     }
     
    
}

//*******************************************************
//函数名称：DisplayPicture
//功能：显示图片
//参数：*PIC指针
//*******************************************************
void DisplayPicture(Uchar *PIC)
{
	int i,j; 
		     
    for(i=0;i<8;i++)
	 {
	  Write_Command(0xB0+i);//set pageaddress start adress
	  Write_Command(0x00);  //set lower column start address
	  Write_Command(0x10);  //set higher column start address		  
	  for(j=0;j<128;j++)
	    { 
	      Write_Data(*PIC++);
	    }	  
     }  
}


//*******************************************************
//函数名称：无
//功能：图片数据
//参数：无
//*******************************************************
const unsigned char code pic[] = {/*--  调入了一幅图像：E:\Program\OLED\HP12864_05_SSD1306\12864.bmp  --*/
/*--  宽度x高度=128x64  --*/
0xFF,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xF1,0x01,
0x01,0x01,0x01,0xE1,0x11,0x11,0x11,0x21,0x01,0x01,0x81,0x81,0x81,0x01,0xE1,0x11,
0x11,0x11,0xE1,0x01,0x01,0xE1,0x11,0x11,0x11,0xE1,0x01,0x01,0x81,0x81,0x81,0x01,
0xE1,0x11,0x11,0x11,0xE1,0x01,0x01,0x01,0x01,0xF1,0x01,0x01,0x01,0x01,0xE1,0x11,
0x11,0x11,0xE1,0x01,0x01,0x11,0x91,0x51,0x31,0x11,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x08,
0x04,0x00,0x00,0x0E,0x11,0x11,0x10,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0x11,
0x11,0x11,0x0E,0x00,0x00,0x0F,0x10,0x10,0x10,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,
0x0E,0x11,0x11,0x11,0x0E,0x00,0x00,0x00,0x00,0x1F,0x08,0x04,0x00,0x00,0x0F,0x10,
0x10,0x10,0x0F,0x00,0x00,0x0E,0x11,0x10,0x10,0x08,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x88,0x88,
0x88,0x88,0x88,0xF8,0x00,0x00,0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x08,0x08,
0x08,0x08,0x08,0xF8,0x00,0x00,0xF0,0x88,0x88,0x88,0x88,0xF8,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x08,0x08,0x88,0xF0,0x00,0x00,0xF0,0x08,
0x08,0x08,0xF0,0x00,0x00,0x70,0x88,0x88,0x08,0x10,0x00,0x00,0x00,0x00,0xF8,0x00,
0x00,0x00,0x00,0xE0,0x10,0x08,0x08,0x08,0x08,0xF8,0x00,0x00,0x70,0x88,0x88,0x88,
0x88,0x30,0x00,0x00,0x70,0x88,0x88,0x88,0x88,0x30,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x08,
0x08,0x08,0x08,0x0F,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0x00,0x00,0x07,0x08,0x08,0x08,0x08,0x0F,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x09,0x09,0x08,0x07,0x00,0x00,0x07,0x08,
0x08,0x08,0x07,0x00,0x00,0x07,0x08,0x08,0x08,0x04,0x00,0x00,0x00,0x00,0x0F,0x04,
0x02,0x00,0x00,0x03,0x04,0x08,0x08,0x08,0x08,0x0F,0x00,0x00,0x06,0x08,0x08,0x08,
0x08,0x07,0x00,0x00,0x06,0x08,0x08,0x08,0x08,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x78,0x84,0x84,0x44,0xF8,0x00,0x00,0xF8,0x44,0x24,0x24,0xC8,0x00,0x00,0x04,0x00,
0x00,0xF8,0x04,0x04,0x04,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xB8,0x44,0x44,0x44,0xB8,0x00,0x00,0x00,0x00,0xFC,0x00,0x00,0x00,0x00,0xB8,
0x44,0x44,0x04,0x08,0x00,0x00,0x78,0x84,0x84,0x84,0xC8,0x00,0x00,0x84,0x64,0x14,
0x0C,0x04,0x00,0x00,0x80,0x40,0x40,0x40,0x40,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x02,0x04,0x04,0x04,0x03,0x00,0x00,0x03,0x04,0x04,0x04,0x03,0x00,0x00,0x00,0x00,
0x00,0x03,0x04,0x04,0x04,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x03,0x04,0x04,0x04,0x03,0x00,0x00,0x00,0x00,0x07,0x02,0x01,0x00,0x00,0x03,
0x04,0x04,0x04,0x02,0x00,0x00,0x04,0x04,0x04,0x06,0x01,0x00,0x00,0x03,0x04,0x04,
0x04,0x02,0x00,0x00,0x03,0x04,0x04,0x04,0x04,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x84,0x84,0x84,0xC8,0x00,0x00,0xF8,0x04,0x04,
0x04,0xF8,0x00,0x00,0x20,0x20,0x20,0x00,0x10,0xFC,0x10,0xD0,0x30,0x00,0x00,0x78,
0x84,0x84,0x44,0xF8,0x00,0x00,0xB8,0x44,0x44,0x44,0xB8,0x00,0x00,0x84,0x64,0x14,
0x0C,0x04,0x00,0x00,0x00,0x00,0xFC,0x00,0x00,0x00,0x00,0x80,0x40,0x40,0x40,0x40,
0xFC,0x00,0x00,0xFC,0x40,0x40,0x40,0x40,0x40,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x80,0x80,0x80,0x84,0x84,0x84,0x86,0x81,0x80,0x80,0x83,0x84,0x84,
0x84,0x83,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x87,0x83,0x80,0x80,0x80,0x80,0x82,
0x84,0x84,0x84,0x83,0x80,0x80,0x83,0x84,0x84,0x84,0x83,0x80,0x80,0x83,0x84,0x84,
0x84,0x82,0x80,0x80,0x80,0x80,0x87,0x82,0x81,0x80,0x80,0x83,0x84,0x84,0x84,0x84,
0x87,0x80,0x80,0x87,0x80,0x80,0x80,0x80,0x80,0x87,0x80,0x80,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xFF



};











//*******************************************************
//*******************************************************
